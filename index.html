<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>painscreen is a dev</title>
  <link rel="stylesheet" href="/style.css" />
  <script>
    window.bad = false;
    let playercolor = "white";
    
    let cursorX = 0;
    let cursorY = 0;
    let mouseOverVideo = false;
    window.debug=false;
    function togglePlayerColor() {
      playercolor = playercolor === "white" ? "black" : "white";
      document.getElementById("col").innerText="You need to stay on "+playercolor
      updatePageStyle();
    }

    function updatePageStyle() {
      const opposite = playercolor === "white" ? "black" : "white";
      document.body.style.backgroundColor = opposite;
      document.body.style.color = playercolor;

      const video = document.querySelector("video");
      const allChildren = document.body.querySelectorAll("*");
      allChildren.forEach(el => {
        if (el !== video && !el.contains(video)) {
          el.style.color = playercolor;
          el.style.backgroundColor = opposite;
        }
      });
    }
      let buffer = 50;
    function onColorMismatch() {
      buffer--;
      if (buffer < 0){
        video.pause()
        console.log("playercolor does not match pixel OR mouse left video");
        if(!debug) location.reload()
        alert("lost")
        buffer= 50 //location.href="https://www.youtube.com/watch?v=oHg5SJYRHA0"
      }
      // Add more logic here as needed
    }

    document.addEventListener('keydown', function (event) {
      if (event.key === "b" && event.ctrlKey && !window.bad) {
        
        const wrapper = document.querySelector("div.wrapper");

        window.video = document.createElement("video");
        window.video.src = "badapple.mp4";
        window.video.autoplay = true;
        window.video.controls = false;
        window.video.width = 640;
        window.video.height = 360;
        wrapper.appendChild(window.video);

        const canvas = document.createElement("canvas");
        canvas.width = 640;
        canvas.height = 360;
        canvas.style.display = "none";
        wrapper.appendChild(canvas);
        const ctx = canvas.getContext("2d");
        togglePlayerColor()
        // Track mouse over video
        video.addEventListener("mousemove", (e) => {
          const rect = video.getBoundingClientRect();
          cursorX = Math.floor(e.clientX - rect.left);
          cursorY = Math.floor(e.clientY - rect.top);
        });

        video.addEventListener("mouseenter", () => {
          mouseOverVideo = true;
        });

        video.addEventListener("mouseleave", () => {
          mouseOverVideo = false;
        });

        video.addEventListener("play", () => {
          function samplePixel() {
            if (video.paused || video.ended) return;

            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            if (!mouseOverVideo) {
              onColorMismatch();
            } else {
              const pixel = ctx.getImageData(cursorX, cursorY, 1, 1).data;
              const avg = (pixel[0] + pixel[1] + pixel[2]) / 3;
              const currentColor = avg > 127 ? "white" : "black";
              if (currentColor !== playercolor) {
                onColorMismatch();
              }
            }

            requestAnimationFrame(samplePixel);
          }

          requestAnimationFrame(samplePixel);
        });

        video.addEventListener("click", () => {
          togglePlayerColor();
        });

        updatePageStyle();
        window.bad = true;
      }
    });
  </script>
</head>
<body>
  <div class="wrapper">
    <div class="content" role="main">
      <h1 class="title" id="header">hey im painscreen</h1>
      <!--<i>(a stupid goober that barely knows how to code and speaks javascript)</i>-->
      <a href="https://discordapp.com/users/836012649959522384/">contact said goober</a>
      <a href="https://github.com/iHategithub9000">github profile</a>
      <!--<a href="https://glitch.com/@iHategithub9000">glitch profile</a>-->
      <i id="col">Press CTRL+B.</i>
    </div>
  </div>
  <script>
    let clicks = 0;
    document.getElementById("header").addEventListener('click', () => {
      clicks++;
      if (clicks == 6) {
        location.href = "https://jcw87.github.io/c2-sans-fight/?mode=normal";
      }
    });
  </script>
</body>
</html>
